<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turing Machine to Single Variable Algebra</title>
    <style>
      html {
      margin: 1.4vh;
      background-color: #eee;
      }
      textarea, input[type="text"] {
      min-width: 100%;
      max-width: 100%;
      }
      textarea {
      height: 50vh;
      }
    </style>
    <head>
  <body>
    <center>
      <a onclick="translate()" href="#"><b>TRANSLATE &#9654;</b></a> |
      <a href="index.html">Single Variable Algebra Playground</a> |
      <a href="https://github.com/772/single-variable-algebra-compiler">Git Repository</a> |
      For convenience, f(x) = g(g(g(x))) equals f(x) = g^[3](x)
    </center>
    <p>Input as <a href="https://wiki.bbchallenge.org/wiki/Turing_machine#Standard_text_format">Turing machine standard text format</a>:</p>
    <p><input type="text" id="input" value="1RB1LB_1LA0LC_1RZ1LD_1RD0RA"></p>
    <p>Output as Single Variable Algebra (SVA):</p>
    <p><textarea style="background-color: lightblue;" id="output" readonly></textarea></p>
    <script>
      function turing_machine_translate(currentState, write0, action0, newstate0, write1, action1, newstate1) {
      	return "+is" + currentState + "(x)*(is0(10*(x-" + currentState + "))*(" + newstate0 + "+" + action0 + "(x-" + currentState + "+0." + newstate0 + "))+is1(10*(x-" + currentState + "))*(" + newstate1 + "+" + action1 + "(x-" + currentState + "+0." + newstate1 + ")))";
      }
      function translate() {
      let tmString = document.getElementById("input").value;
      let algebra = `decimals(x) = 50
abs(x) = (x^2)^(1/2)
H(x) = (x+abs(x))/(2*x)
tiny(x) = 10^(-decimals(x))
ge0(x) = H(x+tiny(x)/10)
lt1(x) = 1-ge0(x-1)
is0(x) = ge0(x)*lt1(x)
is1(x) = is0(x-1)
is2(x) = is0(x-2)
is3(x) = is0(x-3)
is4(x) = is0(x-4)
is5(x) = is0(x-5)
is6(x) = is0(x-6)
is7(x) = is0(x-7)
is8(x) = is0(x-8)
is9(x) = is0(x-9)
floor1(x) = is1(x)+2*is2(x)+3*is3(x)+4*is4(x)+5*is5(x)+6*is6(x)+7*is7(x)+8*is8(x)+9*is9(x)
right(x) = x*10-floor1(x*10)+floor1(x*10)*tiny(x)
left(x) = right^[49](x)
tm(x) = is(0)*x`;
      const blocks = tmString.split("_");
      	blocks.forEach((block, index) => {
      	const currentState = index + 1;
        const trans0 = block.substring(0, 3);
        const write0 = parseInt(trans0[0]);
        const action0 = trans0[1] == "L" ? "left" : "right";
        let newstate0 = trans0[2].charCodeAt(0) - 64;
        newstate0 = newstate0 == 26 ? 0 : newstate0;
        const trans1 = block.substring(3, 6);
        const write1 = parseInt(trans1[0]);
        const action1 = trans1[1] == "L" ? "left" : "right";
        let newstate1 = trans1[2].charCodeAt(0) - 64;
        newstate1 = newstate1 == 26 ? 0 : newstate1;
        algebra += turing_machine_translate(
          currentState,
          write0,
          action0,
          newstate0,
          write1,
          action1,
          newstate1
        );
      });
      	document.getElementById("output").value = algebra + "\n" +
      	`f(x) = tm^[1000000](x)\n` +
      	`f(1)`
      }
      translate();
    </script>
  </body>
</html>
